# ğŸ§¬ PHPæ•æ„Ÿå‡½æ•°é€ŸæŸ¥è¡¨

{% hint style="info" %}
PHPä¸€äº›å®¹æ˜“å‡ºç°å®‰å…¨é—®é¢˜çš„å‡½æ•°æ–¹æ³•
{% endhint %}

## å‘½ä»¤æ‰§è¡Œ

ä¸€äº›å¸¸è§çš„å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°/è¯­æ³•

| å‡½æ•°/è¯­æ³•                | æè¿°                                  | ä¾‹å­                                                         |
| -------------------- | ----------------------------------- | ---------------------------------------------------------- |
| system               | æ‰§è¡Œå‘½ä»¤å¹¶è¾“å‡ºç»“æœ                           | system('id');                                              |
| exec                 | æ‰§è¡Œå‘½ä»¤ åªå¯è·å–æœ€åä¸€è¡Œç»“æœ                     | exec('id',$a); print\_r($a);                               |
| passthru             | åŒ system                            | passthru('id');                                            |
| shell\_exec \` (åå¼•å·) | æ‰§è¡Œå‘½ä»¤å¹¶è¿”å›ç»“æœ                           | $a=shell\_exec('id');print\_r($a); $a=\`id\`;print\_r($a); |
| popen                | æ‰§è¡Œå‘½ä»¤å¹¶å»ºç«‹ç®¡é“ è¿”å›ä¸€ä¸ªæŒ‡é’ˆ ä½¿ç”¨freadç­‰å‡½æ•°æ“ä½œæŒ‡é’ˆè¿›è¡Œè¯»å†™ | $a=popen("id", "r"); echo fread($a, 2096);                 |
| proc\_open           | åŒ popen (è¿›ç¨‹æ§åˆ¶åŠŸèƒ½æ›´å¼ºå¤§)                 | [è§PHPæ‰‹å†Œ](https://www.php.net/manual/zh/function.proc-open) |
| pcntl\_exec          | æ‰§è¡Œå‘½ä»¤ åªè¿”å›æ˜¯å¦å‘ç”Ÿé”™è¯¯                      | pcntl\_exec('id');                                         |

## ä»£ç æ³¨å…¥/æ–‡ä»¶åŒ…å«

| å‡½æ•°/è¯­æ³•ç»“æ„                 | æè¿°                                             | ä¾‹å­                                                                  |
| ----------------------- | ---------------------------------------------- | ------------------------------------------------------------------- |
| eval                    | å°†ä¼ å…¥çš„å‚æ•°å†…å®¹ä½œä¸ºPHPä»£ç æ‰§è¡Œ eval ä¸æ˜¯å‡½æ•° æ˜¯ä¸€ç§è¯­æ³•ç»“æ„ ä¸èƒ½å½“åšå‡½æ•°åŠ¨æ€è°ƒç”¨ | eval('phpinfo();');                                                 |
| assert                  | å°†ä¼ å…¥çš„å‚æ•°å†…å®¹ä½œä¸ºPHPä»£ç æ‰§è¡Œ ç‰ˆæœ¬åœ¨PHP7ä»¥ä¸‹æ˜¯å‡½æ•° PHP7åŠä»¥ä¸Šä¸ºè¯­æ³•ç»“æ„    | assert('phpinfo();');                                               |
| preg\_replace           | å½“preg\_replaceä½¿ç”¨/eä¿®é¥°ç¬¦ä¸”åŸå­—ç¬¦ä¸²å¯æ§æ—¶æ—¶ æœ‰å¯èƒ½æ‰§è¡Œphpä»£ç       | echo preg\_replace("/e","{${PHPINFO()}}","123");                    |
| call\_user\_func        | æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨ éœ€è¦ä¸¤ä¸ªå‚æ•°éƒ½å®Œå…¨å¯æ§æ‰å¯åˆ©ç”¨ åªèƒ½ä¼ å…¥ä¸€ä¸ªå‚æ•°è°ƒç”¨      | call\_user\_func('assert', 'phpinfo();');                           |
| call\_user\_func\_array | åŒcall\_user\_func å¯ä¼ å…¥ä¸€ä¸ªæ•°ç»„å¸¦å…¥å¤šä¸ªå‚æ•°è°ƒç”¨å‡½æ•°            | call\_user\_func\_array ('file\_put\_contents', \['1.txt','6666']); |
| create\_function        | æ ¹æ®ä¼ é€’çš„å‚æ•°åˆ›å»ºåŒ¿åå‡½æ•°ï¼Œå¹¶ä¸ºå…¶è¿”å›å”¯ä¸€åç§° åˆ©ç”¨éœ€è¦ç¬¬äºŒä¸ªå‚æ•°å¯æ§ ä¸”åˆ›å»ºçš„å‡½æ•°è¢«æ‰§è¡Œ  | $f = create\_function('','system($\_GET\[123]);'); $f();            |
| include                 | åŒ…å«å¹¶è¿è¡ŒæŒ‡å®šæ–‡ä»¶ æ‰§è¡Œå‡ºé”™ä¼šæŠ›å‡ºé”™è¯¯                            | include 'vars.php'; (æ‹¬å·å¯æœ‰å¯æ— )                                        |
| require                 | åŒinclude æ‰§è¡Œå‡ºé”™ä¼šæŠ›å‡ºè­¦å‘Š                             | require('somefile.php'); (æ‹¬å·å¯æœ‰å¯æ— )                                   |
| require\_once           | åŒrequire ä½†ä¼šæ£€æŸ¥ä¹‹å‰æ˜¯å¦å·²ç»åŒ…å«è¯¥æ–‡ä»¶ ç¡®ä¿ä¸é‡å¤åŒ…å«               |                                                                     |
| include\_once           | åŒinclude ä½†ä¼šæ£€æŸ¥ä¹‹å‰æ˜¯å¦å·²ç»åŒ…å«è¯¥æ–‡ä»¶ ç¡®ä¿ä¸é‡å¤åŒ…å«               |                                                                     |

## SQL/LDAPæ³¨å…¥

| å‡½æ•°/æ–¹æ³•                                                                                                                                                              | å¤‡æ³¨                                                                                                                                                           |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| mysql\_query                                                                                                                                                       |                                                                                                                                                              |
| odbc\_exec                                                                                                                                                         |                                                                                                                                                              |
| mysqli\_query                                                                                                                                                      |                                                                                                                                                              |
| mysql\_db\_query                                                                                                                                                   |                                                                                                                                                              |
| mysql\_unbuffered\_query                                                                                                                                           |                                                                                                                                                              |
| <p>mysqli::query</p><p>ç”¨æ³•</p><p>$mysqli = new mysqli("localhost", "my_user", "my_password", "world");</p><p>$mysqli->query();</p>                                  |                                                                                                                                                              |
| pg\_query                                                                                                                                                          |                                                                                                                                                              |
| pg\_query\_params                                                                                                                                                  |                                                                                                                                                              |
| pg\_send\_query                                                                                                                                                    |                                                                                                                                                              |
| pg\_send\_query\_params                                                                                                                                            |                                                                                                                                                              |
| sqlsrv\_query                                                                                                                                                      |                                                                                                                                                              |
| <p>pdo::query</p><p>$pdo=new PDO("mysql:host=localhost;dbname=phpdemo","root","1234"); $pdo->query($sql);;</p>                                                     | PDO                                                                                                                                                          |
| <p>SQLite3::query</p><p>SQLite3::exec</p><p>$db = new SQLite3('mysqlitedb.db'); $db->query('SELECT bar FROM foo'); $db->exec('CREATE TABLE bar (bar STRING)');</p> |                                                                                                                                                              |
| $mongo = new mongoclient(); $data = $coll->find($data);                                                                                                            | [https://wooyun.js.org/drops/Mongodb%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB.html](https://wooyun.js.org/drops/Mongodb%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB.html) |
| $ld = ldap\_connect("localhost");â€¦. $lb = @ldap\_bind($ld, "cn=test,dc=test,dc=com", "test");                                                                      | [https://www.cnblogs.com/0nc3/p/12063436.html](https://www.cnblogs.com/0nc3/p/12063436.html)                                                                 |
| Db::query                                                                                                                                                          | Thinkphp                                                                                                                                                     |
| Db::execute                                                                                                                                                        | Thinkphp                                                                                                                                                     |

## æ–‡ä»¶è¯»å–/SSRF

| å‡½æ•°                                                       | æè¿°                        | ä¾‹å­                                                                                                                                                                                                                                                                   |
| -------------------------------------------------------- | ------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| file\_get\_contents                                      | è¯»å…¥æ–‡ä»¶è¿”å›å­—ç¬¦ä¸²                 | echo file\_get\_contents("flag.txt"); echo file\_get\_contents("https://www.bilibili.com/");                                                                                                                                                                         |
| curl\_setopt curl\_exec                                  | Curlè®¿é—®urlè·å–ä¿¡æ¯             | function curl($url){ $ch = curl\_init(); curl\_setopt($ch, CURLOPT\_URL, $url); curl\_exec($ch); curl\_close($ch); } $url = $\_GET\['url']; curl($url); [https://www.php.net/manual/zh/function.curl-exec.php](https://www.php.net/manual/zh/function.curl-exec.php) |
| fsockopen                                                | æ‰“å¼€ä¸€ä¸ªå¥—æ¥å­—è¿æ¥(è¿œç¨‹ tcp/udp raw) | [https://www.php.net/manual/zh/function.fsockopen.php](https://www.php.net/manual/zh/function.fsockopen.php)                                                                                                                                                         |
| readfile                                                 | è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶å†™å…¥åˆ°è¾“å‡ºç¼“å†²           | åŒfile\_get\_contents                                                                                                                                                                                                                                                 |
| fopen/fread/fgets/fgetss /fgetc/fgetcsv/fpassthru/fscanf | æ‰“å¼€æ–‡ä»¶æˆ–è€… URL è¯»å–æ–‡ä»¶æµ          | $file = fopen("test.txt","r"); echo fread($file,"1234"); fclose($file);                                                                                                                                                                                              |
| file                                                     | æŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªæ•°ç»„ä¸­              | echo implode('', file('https://www.bilibili.com/'));                                                                                                                                                                                                                 |
| highlight\_file/show\_source                             | è¯­æ³•é«˜äº®ä¸€ä¸ªæ–‡ä»¶                  | highlight\_file("1.php");                                                                                                                                                                                                                                            |
| parse\_ini\_file                                         | è¯»å–å¹¶è§£æä¸€ä¸ªinié…ç½®æ–‡ä»¶            | print\_r(parse\_ini\_file('1.ini'));                                                                                                                                                                                                                                 |
| simplexml\_load\_file                                    | è¯»å–æ–‡ä»¶ä½œä¸ºXMLæ–‡æ¡£è§£æ             |                                                                                                                                                                                                                                                                      |

## æ–‡ä»¶ä¸Šä¼ /å†™å…¥/å…¶ä»–

| å‡½æ•°                                                               | æè¿°                                                                                                                                                                                        | ä¾‹å­                                                                                                                                                                                                                                                            |
| ---------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| file\_put\_contents                                              | å°†ä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶                                                                                                                                                                                | file\_put\_contents("1.txt","6666");                                                                                                                                                                                                                          |
| move\_uploaded\_file                                             | å°†ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ç§»åŠ¨åˆ°æ–°çš„ä½ç½®                                                                                                                                                                           | move\_uploaded\_file($\_FILES\["pictures"]\["tmp\_name"],"1.php")                                                                                                                                                                                             |
| rename                                                           | é‡å‘½åæ–‡ä»¶/ç›®å½•                                                                                                                                                                                  | rename($oldname, $newname);                                                                                                                                                                                                                                   |
| rmdir                                                            | åˆ é™¤ç›®å½•                                                                                                                                                                                      |                                                                                                                                                                                                                                                               |
| mkdir                                                            | åˆ›å»ºç›®å½•                                                                                                                                                                                      |                                                                                                                                                                                                                                                               |
| unlink                                                           | åˆ é™¤æ–‡ä»¶                                                                                                                                                                                      |                                                                                                                                                                                                                                                               |
| copy                                                             | å¤åˆ¶æ–‡ä»¶                                                                                                                                                                                      | copy($file, $newfile);                                                                                                                                                                                                                                        |
| fopen/fputs/fwrite                                               | æ‰“å¼€æ–‡ä»¶æˆ–è€… URL                                                                                                                                                                                | [https://www.php.net/manual/zh/function.fwrite.php](https://www.php.net/manual/zh/function.fwrite.php)                                                                                                                                                        |
| link                                                             | åˆ›å»ºæ–‡ä»¶ç¡¬é“¾æ¥                                                                                                                                                                                   | link($target, $link);                                                                                                                                                                                                                                         |
| symlink                                                          | åˆ›å»ºç¬¦å·é“¾æ¥(è½¯é“¾æ¥)                                                                                                                                                                               | symlink($target, $link);                                                                                                                                                                                                                                      |
| tmpfile                                                          | åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ (åœ¨ä¸´æ—¶ç›®å½•å­˜æ”¾ éšæœºæ–‡ä»¶å è¿”å›å¥æŸ„)                                                                                                                                                             | $temp = tmpfile(); fwrite($temp, "123456"); fclose($temp);                                                                                                                                                                                                    |
| <p>request()->file()->move()</p><p>request()->file()->file()</p> | ****[**Thinkphp æ–‡ä»¶ä¸Šä¼ **](https://www.kancloud.cn/manual/thinkphp5/155159)****                                                                                                              | <p>$file = request()->file($name);</p><p>$file->move($filepath);</p>                                                                                                                                                                                          |
| extractTo                                                        | è§£å‹ZIPåˆ°ç›®å½•                                                                                                                                                                                  |                                                                                                                                                                                                                                                               |
| DOMDocument loadXML simplexml\_import\_dom                       | åŠ è½½è§£æXML æœ‰å¯èƒ½å­˜åœ¨XXEE æ¼æ´ file\_get\_contentsè·å–å®¢æˆ·ç«¯è¾“å…¥å†…å®¹ new DOMDocument()åˆå§‹åŒ–XMLè§£æå™¨ loadXML($xmlfile)åŠ è½½å®¢æˆ·ç«¯è¾“å…¥çš„XMLå†…å®¹ simplexml\_import\_dom($dom)è·å–XMLæ–‡æ¡£èŠ‚ç‚¹ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›SimpleXMLElementå¯¹è±¡ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å›FALSEã€‚ | \<?php $xmlfile=file\_get\_contents('php://input'); $dom=new DOMDocument(); $dom->loadXML($xmlfile); $xml=simplexml\_import\_dom($dom); $xxe=$xml->xxe; $str="$xxe \n"; echo $str; ?> _æ¥è‡ª <_[_https://xz.aliyun.com/t/6887_](https://xz.aliyun.com/t/6887)_>_ |
| simplexml\_load\_string                                          | åŠ è½½è§£æXMLå­—ç¬¦ä¸² æœ‰å¯èƒ½å­˜åœ¨XXE æ¼æ´                                                                                                                                                                    | $xml=simplexml\_load\_string($\_REQUEST\['xml']); print\_r($xml);                                                                                                                                                                                             |
| simplexml\_load\_file                                            | è¯»å–æ–‡ä»¶ä½œä¸ºXMLæ–‡æ¡£è§£æ æœ‰å¯èƒ½å­˜åœ¨XXE æ¼æ´                                                                                                                                                                 |                                                                                                                                                                                                                                                               |
| unserialize                                                      | ååºåˆ—åŒ–                                                                                                                                                                                      |                                                                                                                                                                                                                                                               |
